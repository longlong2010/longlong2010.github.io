<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <title>Long Long</title>
    <link rel="Shortcut Icon" href="/favicon.ico" type="image/x-icon" />
	<link href="/bootstrap/css/bootstrap.css" rel="stylesheet">
    <link href="/css/blog.css" rel="stylesheet">
  </head>
  <body>
    <div class="blog-masthead">
      <div class="container">
        <nav class="blog-nav">
          <a class="blog-nav-item active" href="/">Home</a>
        </nav>
      </div>
    </div>

    <div class="container">

      <div class="blog-header">
        <h1 class="blog-title">LongLong's Blog</h1>
        <p class="lead blog-description">分享IT技术，分享生活感悟，热爱摄影，热爱航天。</p>
      </div>

      <div class="row">
        <div class="col-sm-8 blog-main">
		  
		  <div class="blog-post">
		  	<a href="/2015/02/05/redis-cluster.html"><h2 class="blog-post-title">Redis Cluster配置</h2></a>
			<p class="blog-post-meta">05 February 2015</p>
			<blockquote>
  <p>Redis 3.0终于要发布了，目前是RC3并且很可能是最后一个RC版本，2月中就可能会发布正式版。关注这个功能很久了，但一直到离职都没有测试过，之前是用一致性散列算法(ketama)实现了基于客户端的分布式方案，优点是比较简单灵活，配置也比较简单，但缺点就是一些同时操作多个键的命令将无法使用(如mget move等)，同时扩容时数据的迁移也是个麻烦的过程(如果不使用持久化则还好)。</p>
</blockquote>

<blockquote>
  <p>官方的文档可以参考<a href="http://redis.io/topics/cluster-tutorial">这里</a></p>
</blockquote>

<h4 id="cluster">1. Cluster基本配置</h4>
<blockquote>
  <p>基本配置文件如下，其中nodes.6380.conf是Redis自己生成的配置文件，这里只是指定生成文件的路径。</p>

  <pre><code>port 6380
cluster-enabled yes
cluster-config-file nodes.6380.conf
cluster-node-timeout 5000
</code></pre>

  <p>其中cluster-node-timeout是一个比较关键的参数，当一个节点在超时时间过后依然无响应，将被判定为失效并由其他的节点提到，如果没有能够替代的节点则写入会失败。</p>
</blockquote>

<h4 id="cluster-1">2. Cluster启动</h4>
<blockquote>
  <p>每个Redis实例独立进行启动，在启动后其除了监听本来配置的端口外还会监听一个设置的端口+10000的端口作为Cluster的各个节点通信使用。如port设置为6380，则还会开启16380端口。</p>

  <pre><code>tcp	0	0 0.0.0.0:6380		0.0.0.0:*	LISTEN
tcp	0	0 0.0.0.0:16380		0.0.0.0:*	LISTEN
</code></pre>

  <p>第一次创建Redis Cluster时需要进行一次初始化操作。初始化的命令需要Ruby支持，并且需要安装Ruby Redis模块</p>

  <pre><code>pacman -S ruby
gem install redis
src/redis-trib.rb create --replicas 1 127.0.0.1:6380 127.0.0.1:6381 127.0.0.1:6382 127.0.0.1:6383
</code></pre>

  <p>同时用redis-trib.rb工具还可以对Cluster进行增加节点，删除节点，数据转移等操作。</p>
</blockquote>

<h4 id="cluster-2">3. 读写Cluster</h4>
<blockquote>
  <p>对于Cluster的读写依然可以使用redis-cli，连接Cluster中的任何一个实例都可以，但需要加参数-c使其使用读写Cluster的协议。通过telnet测试发现Redis Cluster本质上也需要客户端进行性支持才能实现，基本上相当于一致性散列算法由Redis完成。</p>
</blockquote>

<h4 id="section">4. 故障转移及高可用</h4>

		  </div>
		  
		  <!-- /.blog-post -->
          
		  <nav>
            <ul class="pager">
              
			  
              <li><a href="/page2">Next</a></li>
			  
            </ul>
          </nav>
		  
        </div><!-- /.blog-main -->
		        <div class="col-sm-3 col-sm-offset-1 blog-sidebar">
          <div class="sidebar-module sidebar-module-inset">
            <h4>About</h4>
            <p>龙_2  <p>低调，淡定，技术流，忠实的爱国主义者，前宝宝树运维工程师。</p></p>
          </div>
		  
		  <!--
          <div class="sidebar-module">
            <h4>Archives</h4>
            <ol class="list-unstyled">
              <li><a href="#">March 2014</a></li>
              <li><a href="#">February 2014</a></li>
              <li><a href="#">January 2014</a></li>
              <li><a href="#">December 2013</a></li>
              <li><a href="#">November 2013</a></li>
              <li><a href="#">October 2013</a></li>
              <li><a href="#">September 2013</a></li>
              <li><a href="#">August 2013</a></li>
              <li><a href="#">July 2013</a></li>
              <li><a href="#">June 2013</a></li>
              <li><a href="#">May 2013</a></li>
              <li><a href="#">April 2013</a></li>
            </ol>
          </div>
		  -->

          <div class="sidebar-module">
            <h4>Elsewhere</h4>
            <ol class="list-unstyled">
              <li><a href="http://github.com/longlong2010">GitHub</a></li>
              <li><a href="http://weibo.com/dragondragon2">Weibo</a></li>
              <li><a href="http://blog.sina.com.cn/dragondragon2">Blog</a></li>
            </ol>
          </div>

        </div><!-- /.blog-sidebar -->

      </div><!-- /.row -->
    </div><!-- /.container -->

	<footer class="blog-footer">
      <p>Blog template built by <a href="http://getbootstrap.com">Bootstrap</a> </p>
      <p>
        <a href="#">Back to top</a>
      </p>
    </footer>
    
	<script src="/bootstrap/js/bootstrap.js"></script>
  </body>
</html>

